<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body ng-app="app">
    <div ng-controller="PostsCtrl" class="container">
        <h1>Recent Posts</h1>
        <form role="form">
            <div class="form-group">
                <div class="input-group">
                    <input ng-model="postBody" class="form-control" />
                    <span class="input-group-btn">
                        <button ng-click="addPost()" class="btn btn-default">Add Post</button>
                    </span>
                </div>
            </div>
        </form>
        <ul class="list-group">
            <li ng-repeat="post in posts | orderBy: '-date' " class="list-group-item">
                <strong>@{{ post.username }}</strong>
                <span>{{ post.body }}</span>
            </li>
        </ul>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.js"></script>
    <script>
        // create our app module
        var app = angular.module('app', []);

        // create the PostsCtrl module
        // dependency inject $scope
        app.controller('PostsCtrl', function($scope, $http) {

            // the function runs when the "Add Post" button is clicked
            $scope.addPost = function () {
                // only add a post if there is a body
                if ($scope.postBody) {
                    $http.post('/api/posts', {
                        username: 'lenmorld',
                        body: $scope.postBody
                    }).then(function (post) {
                        $scope.posts.unshift(post);     // if successfully POSTed to server, add to posts
                        $scope.postBody = null;

                        // must reload UI by fetching all todo items again
                        $scope.fetchAll();
                    });
                }
            }

//            $http.get('http://localhost:3000/api/posts')      // served outside the API
            $scope.fetchAll = function () {
                $http.get('/api/posts')
                        .then(function (posts) {
                            console.log(posts);
                            $scope.posts = posts.data;
                        });
                // success() deprecated
            };

            $scope.fetchAll();


        });
    </script>
</body>
</html>